{% extends "base.html" %}
{% block head_extra %}
{% if breadcrumbs %}<script type="application/ld+json">{{ breadcrumbs|tojson }}</script>{% endif %}
{% if website_json %}<script type="application/ld+json">{{ website_json|tojson }}</script>{% endif %}
{% if blog_json %}<script type="application/ld+json">{{ blog_json|tojson }}</script>{% endif %}
{% endblock %}
{% block content %}
{% if preview %}
<div class="preview-banner" role="status">Preview mode — this post is visible only to admins.</div>
{% endif %}
<article class="container article article--theme-{{ hero_style }}">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
        <ol>
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li><a href="{{ url_for('reports_index') }}">Reports</a></li>
            <li aria-current="page">{{ post.title }}</li>
        </ol>
    </nav>
    <header class="article-header">
        {% if post.hero_kicker %}
        <p class="article-kicker">{{ post.hero_kicker }}</p>
        {% endif %}
        <h1>{{ post.title }}</h1>
        <p class="muted">{{ post.publish_date|format_date or post.created_at|format_date }} · {{ read_time }} min read</p>
        <p class="muted tags">{% for tag in post.tags|tag_list %}<span class="tag">{{ tag }}</span>{% if not loop.last %} {% endif %}{% endfor %}</p>
        <div class="share-links">
            <a href="https://x.com/intent/tweet?url={{ meta.canonical|urlencode }}&text={{ post.title|urlencode }}" target="_blank" rel="noopener">Share on X</a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ meta.canonical|urlencode }}&title={{ post.title|urlencode }}" target="_blank" rel="noopener">Share on LinkedIn</a>
        </div>
        {% if summary_points %}
        <ul class="summary-points">
            {% for point in summary_points %}
            <li>{{ point }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </header>
    {% if post.cover_url %}
    {% set placeholder_cover = url_for('static', filename='img/blog-placeholder.svg') %}
    <div class="article-cover">
        <img src="{{ post.cover_url }}" alt="" loading="lazy" data-img-fallback="{{ placeholder_cover }}">
    </div>
    {% endif %}
    <div class="article-grid">
        <div class="article-main">
            {% if post.highlight_quote %}
            <blockquote class="article-quote">{{ post.highlight_quote }}</blockquote>
            {% endif %}

            <div class="like-widget" data-like-widget data-like-url="{{ url_for('post_like_api', slug=post.slug) }}" data-csrf-token="{{ csrf_token() }}" data-liked="{{ 1 if liked else 0 }}">
                <button type="button" class="like-widget__button" data-like-button aria-pressed="{{ 'true' if liked else 'false' }}">
                    <span class="like-widget__icon" aria-hidden="true">♥</span>
                    <span class="like-widget__label" data-like-label>{{ "Liked" if liked else "Like" }}</span>
                </button>
                <div class="like-widget__meta" aria-live="polite">
                    <span class="like-widget__count" data-like-count>{{ like_count }}</span>
                    <span class="like-widget__count-label">likes</span>
                </div>
            </div>

            <div class="article-body" data-article-content>
                {{ post.content|safe }}
            </div>
            {% if post.cta_label and post.cta_url %}
            <div class="article-cta">
                <a class="button primary" href="{{ post.cta_url }}" target="_blank" rel="noopener">{{ post.cta_label }}</a>
            </div>
            {% endif %}
        </div>
        <aside class="article-aside">
            {% if more_posts %}
            <div class="more-posts">
                <h2>More reports</h2>
                <ul>
                    {% for p in more_posts %}
                    <li><a href="{{ url_for('post_detail', slug=p.slug) }}">{{ p.title }}</a></li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </aside>
    </div>
</article>
{% endblock %}
